<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <link rel="alternate" type="application/rss+xml"
   href="feed.rss" title="RSS feed for My Page">
  <title>my blog</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      word-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
	body {
		margin : 0;
		max-width : none; 
		background-color : black;
		color : white;
	}
	h1 {
		text-align : center;
	}	
	h2 {
		text-align : center;
	}	
	h3 {
		text-align : center;
	}
	p {
		text-align : justify;
		min-width:200px;max-width:900px;margin:0 auto;padding:15px;
	}
	li {
		text-align : left;
		min-width:200px;max-width:900px;margin:0 auto;padding:15px
	}
	pre {
		text-align : left;
		min-width:200px;max-width:900px;margin:0 auto;padding:15px
	}
	div.sourceCode {
		text-align : left;
		min-width:200px;max-width:900px;margin:0 auto;padding:15px
	}
	#HME {
		text-decoration : none;
		float : left;
	}
	#LNK {
		text-decoration : none;
		float : right;
	}
	#NCE {
		text-decoration-line : underline;
		text-decoration-color : blue;
		color : blue;
	}
	img {
	-webkit-filter: invert(1);
	filter: invert(1);	
	}
	a {
		text-decoration : none;
		color : white;
	}
	a:visited {
		text-decoration : none;
		color : white;
	}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<a id = "LNK" 
	href = blogdark.html>üè†</a>
<a id = "LNK" 
	href = 2021-01-22_gen_light.html>‚òÄÔ∏è </a>
</br>
<header id="title-block-header">
<h1 class="title">my blog</h1>
<p class="author"><center>
<a href="mailto:kacpertopol@gmail.com">kacper topolnicki</a></br><a href="mailto:kacpertopol@gmail.com">kacpertopol@gmail.com</a>
<center></p>
</header>
<h1 id="binary-image-compression-with-python-and-numpy">binary image compression with python and numpy</h1>
<center>
<em>2021-01-22</em>
</center>
<p>numpy-thonic run length compression ‚Ä¶</p>
<p>I‚Äôve been tinkering with my <a id = "NCE" href = https://github.com/kacpertopol/cam_board>cam_board</a> script. This little program can turn a web cam into a white / black board. I found it handy in these rough, socially isolated, disease ridden times. The de-noising feature of the script is particularly useful when recording the ‚Äúblackboard‚Äù for students because it greatly reduces the video file sizes. I was wondering if it would be possible to have a compression algorithm built into the script. Ideally, to reduce compression time, the compression procedure would rely heavily on the fast methods of the <code>numpy</code> library. This post describes the resulting algorithm. This description is also part of an assignment where I ask students to implement the same algorithm without <code>numpy</code> and compare compression times. The script and sample image can be downloaded from <a id = "NCE" href = https://github.com/kacpertopol/rcnumpy>here</a>.</p>
<p>The script begins with two import statements in [compress.py line: 9] :</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span></code></pre></div>
<p><strong>Loading the binary image</strong></p>
<p>In our example we will be working with a 720 by 1280 image. The individual pixels in this image will contain one of two values : 0 , 1. This means that 921600 bits or 115200 bytes are used to represent the image. The image data is stored in <code>image.npy</code> in a special format designed to store <code>numpy</code> arrays. This file was created using the <code>numpy.packbits</code> function and you can verify that it is almost exactly 115200 bytes long.</p>
<p>The file is loaded and stored in variable <code>a</code> in [compress.py line: 67] :</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> numpy.load(<span class="st">&quot;image.npy&quot;</span>)</span></code></pre></div>
<p>and next it is unpacked in [compress.py line: 70] :</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">=</span> numpy.unpackbits(a)</span></code></pre></div>
<p>Information about <code>a</code> is printed to the standard output in [compress.py line: 74] :</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;a.shape : &quot;</span> , a.shape)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;a.dtype : &quot;</span> , a.dtype)</span></code></pre></div>
<p>The first print statement will result in:</p>
<pre><code>a.shape :  (921600,)</code></pre>
<p>which means that we are dealing with a one dimensional array of size 921600. This is used in [compress.py line: 79] :</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>length <span class="op">=</span> a.shape[<span class="dv">0</span>:<span class="dv">1</span>]</span></code></pre></div>
<p>to assign the length of <code>a</code> to a variable. The second print statement will result in:</p>
<pre><code> a.dtype :  uint8</code></pre>
<p>from which we can gather that all values in this one dimensional array are unsigned 8-bit integers.</p>
<p>The unpacked array of unsigned 8-bit integers can be saved to a file. This is done in [compress.py line: 83] :</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>numpy.save(<span class="st">&quot;image_unpacked&quot;</span> , a)</span></code></pre></div>
<p>and the resulting file <code>image_unpacked.npy</code> contains 921728 bytes. This is almost eight times more then <code>image.npy</code>.</p>
<p><strong>Compression method</strong></p>
<p>The idea behind the compression method is simple. More formally the algorithm that will be implemented belongs to a family of <em>run time compression</em> algorithms.</p>
<p>Since the data we are working with is just a string of 0, 1 :</p>
<pre><code>0 1 1 1 1 1 1 1 1 0 1 1 1 0 0 0 0 0 0 0 0 1 ...</code></pre>
<p>it will be represented by the lengths of sequances of ones and zeros that appear the sequence:</p>
<pre><code>1 8 1 3 8 ...</code></pre>
<p>This information together with the value of the first element of the sequence :</p>
<pre><code>0</code></pre>
<p>can be used to reconstruct the original image.</p>
<p>The value of the first element of <code>a</code> is assigned to a variable in [compress.py line: 138] :</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>first <span class="op">=</span> a[<span class="dv">0</span>:<span class="dv">1</span>]</span></code></pre></div>
<p>Notice that the variable <code>first</code> points to a <code>numpy</code> array and not a single value. This array was created by taking a segment of <code>a</code> (<code>a[0:1]</code>), that is elements with indexes greater or equal to 0 and less then 1. This means that <code>first</code> is a one dimensional array with one element - the first value in <code>a</code>. The choice to use an array with a single element instead of a single value will be useful later when <code>first</code> will be concatenated with other arrays.</p>
<p>In order to obtain a lengths of sequences for the compression algorithm first a list of indexes with non zero elements (ones) is created and assigned to a variable in [compress.py line: 142] :</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>nonzero <span class="op">=</span> numpy.nonzero(a)[<span class="dv">0</span>]</span></code></pre></div>
<p>The next lines [compress.py line: 146] :</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> numpy.nonzero((numpy.roll(nonzero,<span class="dv">1</span>) <span class="op">+</span> <span class="dv">1</span>) <span class="op">-</span> nonzero)[<span class="dv">0</span>]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> numpy.nonzero((numpy.roll(nonzero,<span class="op">-</span><span class="dv">1</span>) <span class="op">-</span> <span class="dv">1</span>) <span class="op">-</span> nonzero)[<span class="dv">0</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>ones <span class="op">=</span> end <span class="op">-</span> start <span class="op">+</span> <span class="dv">1</span></span></code></pre></div>
<p>result in the variable <code>ones</code> containing a list of lenths of <code>1 , 1 , 1 , ...</code> sequences in <code>a</code>. This code uses a combination of <code>numpy</code> functions. The reader is encouraged to try this code out in <code>ipython</code> and read the documentation on these routines. The next lines of code [compress.py line: 152] :</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>ai <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> a</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>nonzero <span class="op">=</span> numpy.nonzero(ai)[<span class="dv">0</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>start <span class="op">=</span> numpy.nonzero((numpy.roll(nonzero,<span class="dv">1</span>) <span class="op">+</span> <span class="dv">1</span>) <span class="op">-</span> nonzero)[<span class="dv">0</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>end <span class="op">=</span> numpy.nonzero((numpy.roll(nonzero,<span class="op">-</span><span class="dv">1</span>) <span class="op">-</span> <span class="dv">1</span>) <span class="op">-</span> nonzero)[<span class="dv">0</span>]</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>zeros <span class="op">=</span> end <span class="op">-</span> start <span class="op">+</span> <span class="dv">1</span></span></code></pre></div>
<p>result in the variable <code>zeros</code> containing a list of lengths of <code>0 , 0 , 0 , ...</code> sequences in <code>a</code>.</p>
<p><strong>Compressed data</strong></p>
<p>All the data necessary to reconstruct the original image is concatenated in [compress.py line: 175] :</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> numpy.concatenate(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>            length , </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>            first , </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>            zeros.shape[<span class="dv">0</span>:<span class="dv">1</span>] , </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>            zeros , </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>            ones.shape[<span class="dv">0</span>:<span class="dv">1</span>] , </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            ones</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>        ))</span></code></pre></div>
<p>In order to firther save space, this array is rewritten using unigned 32-bit integers in [compress.py line: 187] :</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> data.astype(<span class="st">&quot;uint32&quot;</span>)</span></code></pre></div>
<p>Finally the data is saved to <code>image_compressed.npy</code> in [compress.py line: 198] :</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>numpy.save(<span class="st">&quot;image_compressed&quot;</span> , data)</span></code></pre></div>
<p>Notice that the size of this file is only 20892 bytes.</p>
<p><strong>Reconstructing the original image</strong></p>
<p>Now it is time to to check if it is possible to reconstruct the original image from <code>image_compressed.npy</code>. In the first step this file is loaded from disk [compress.py line: 212] :</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>comp <span class="op">=</span> numpy.load(<span class="st">&quot;image_compressed.npy&quot;</span>)</span></code></pre></div>
<p>Next in [compress.py line: 232] :</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>l <span class="op">=</span> comp[<span class="dv">0</span>]</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>f <span class="op">=</span> comp[<span class="dv">1</span>]</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>zs <span class="op">=</span> comp[<span class="dv">2</span>]</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>z <span class="op">=</span> comp[<span class="dv">3</span> : <span class="dv">3</span> <span class="op">+</span> zs]</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>os <span class="op">=</span> comp[<span class="dv">3</span> <span class="op">+</span> zs]</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>o <span class="op">=</span> comp[<span class="dv">3</span> <span class="op">+</span> zs <span class="op">+</span> <span class="dv">1</span>:]</span></code></pre></div>
<p>the</p>
<ul>
<li>length of <code>a</code></li>
<li>first element</li>
<li>length of list with <code>0 0 0 ...</code> sequence lengths</li>
<li>list of <code>0 0 0 ...</code> sequence lengths</li>
<li>length of list with <code>1 1 1 ...</code> sequence lengths</li>
<li>list of <code>1 1 1 ...</code> sequence lengths</li>
</ul>
<p>are assigned to variables.</p>
<p>Next in [compress.py line: 251] :</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>rif <span class="op">=</span> numpy.empty(zs <span class="op">+</span> os , dtype <span class="op">=</span> z.dtype)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>val <span class="op">=</span> numpy.empty(zs <span class="op">+</span> os , dtype <span class="op">=</span> z.dtype)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(first <span class="op">==</span> <span class="dv">0</span>):</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    rif[<span class="dv">0</span>::<span class="dv">2</span>] <span class="op">=</span> z</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    rif[<span class="dv">1</span>::<span class="dv">2</span>] <span class="op">=</span> o</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    val[<span class="dv">0</span>::<span class="dv">2</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    val[<span class="dv">1</span>::<span class="dv">2</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    rif[<span class="dv">0</span>::<span class="dv">2</span>] <span class="op">=</span> o</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    rif[<span class="dv">1</span>::<span class="dv">2</span>] <span class="op">=</span> z </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    val[<span class="dv">0</span>::<span class="dv">2</span>] <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    val[<span class="dv">1</span>::<span class="dv">2</span>] <span class="op">=</span> <span class="dv">0</span></span></code></pre></div>
<p>two, initialy empty, <code>numpy</code> arrays are created. <code>rif</code> will contain interwoven <code>0 0 0 ...</code> and <code>1 1 1 ...</code> sequence lengths and <code>val</code> will contain the values (0 or 1) associated with the corresponding sequence length. Note the <code>[0::2]</code> and <code>[1::2]</code> operators used for achieve this. They allow assigning values to every second element of a <code>numpy</code> array starting with the first (index 0) or second (index 1) element.</p>
<p>The original array is reconstructed in [compress.py line: 278] :</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>reconstruct <span class="op">=</span> numpy.repeat(val , rif)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>reconstruct <span class="op">=</span> reconstruct.astype(<span class="st">&quot;uint8&quot;</span>)</span></code></pre></div>
<p>and tested against the original array <code>a</code> in [compress.py line: 283] :</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;test against original : &quot;</span> , </span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>        numpy.array_equal(a , reconstruct))</span></code></pre></div>
<p>using the <code>numpy.array_equal</code> function.</p>
<p><strong>Drawing the images</strong></p>
<p>In [compress.py line: 308] :</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>fig , axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>)</span></code></pre></div>
<p>a plot containing two subplots is created. One subplot will contain the original image and the other one will contain the reconstructed image. In order to draw the images, the one dimensional arrays have to be reshaped first in: [compress.py line: 312] :</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>img_compressed <span class="op">=</span> a.reshape((<span class="dv">720</span> , <span class="dv">1280</span>))</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>img_reconstruct <span class="op">=</span> reconstruct.reshape((<span class="dv">720</span> , <span class="dv">1280</span>))</span></code></pre></div>
<p>Finally in [compress.py line: 317] :</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].imshow(img_compressed)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].imshow(img_reconstruct)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<p>the arrays are plotted and shown.</p>
<center>
<img src="./2021-01-22/Figure_1.png" />
</center>
<p>2021-01-22 EDIT: minor corrections</p>
<br/>
<a id = "LNK" 
   href = "feed.rss"><img src = "Feed-icon.svg" height = 14em></a>
</body>
</html>
